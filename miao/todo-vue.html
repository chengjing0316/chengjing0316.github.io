<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TODO</title>
  <script src="./vue-2.7.14.js"></script>
  <style>
    html,body{
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background-color: rgb(245,245,245);
      font: 14px 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }
    div.wrapper{
      width: 50%;
      height: 100%;
      margin: auto;
      text-align: center;
      font-size: 30px;
    }
    h1{
      margin: 0;
      color: #EAD7D7;
      font-size: 100px;
    }
    li{
      list-style: none;
    }
    .delete{
      text-decoration: line-through;
    }
    .bar > *{
      display: inline-block;
    }
    .bar > ul > *{
      display: inline-block;
    }

    ul.visible-active li.completed{
      display: none;
    }
    ul.visible-completed li:not(.completed) {
      display: none;
    }
    .completed {
      text-decoration: line-through;
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <!-- 标题 -->
    <header>
      <h1>todos</h1>
    </header>

    <!-- 主体 -->
    <div class="main">
      <div>
        <input type="checkbox">
        <input type="text" @keyup.enter="addTodo($event)" placeholder="What needs to be done?">
      </div>
      <ul id="memolist" :class="`visible-${visibleTodos}`">
        <li :class="todo.completed ? 'completed':'active'" v-for="(todo, idx) of showList(todos)">
          <input data-index="0" type="checkbox" :checked="todo.completed" @change="changeTodoState(idx)">
          <span v-show="editIdx !== idx" @dblclick="edit(idx)">{{ todo.content }}</span>
          <input 
            :value="todo.content"
            v-show="editIdx == idx"
            @keyup.enter="todo.content = $event.target.value.trim();editIdx=-1"
            @blur="todo.content = $event.target.value.trim();editIdx = -1"
            type="text">
          <button @click="deleteTodo(idx)">&times;</button>
        </li>
      </ul>
      <div class="bar">
        <span><em>{{ todos.filter(it => !it.completed).length }}</em>items left</span>
        <div class="visible-select">
          <label><input type="radio" @click="visibleTodos = $event.target.value" value="all" name="visible-todos" checked> All</label>
          <label><input type="radio" @click="visibleTodos = $event.target.value" value="active" name="visible-todos" > Active</label>
          <label><input type="radio" @click="visibleTodos = $event.target.value" value="completed" name="visible-todos" > Completed</label>
        </div>
        <button>Clear completed</button>
      </div>
    </div>

    <!-- 底部 -->
    <footer>
      <p></p>
      <p></p>
      <p></p>
    </footer>
  </div>
</body>

<script>
  var app = new Vue({
    el:'.wrapper',
    data:{
      todos:JSON.parse(localStorage.getItem('todos')) ?? [{
          content: 'drink',
          completed: false,
      }],
      visibleTodos: 'all',
      editIdx: -1
    },
    watch:{//要监控的字段
      todos:{//深度监控
        deep:true,
        handler:function(){
          localStorage.setItem('todos', JSON.stringify(this.todos))
        }
      }
    },
    methods:{
      //
      edit(idx){
        this.editIdx = idx
      },
      //三种情况的切换
      showList(){
        if(this.visibleTodos == 'completed'){
          return this.todos.filter(it => it.completed)
        }else if(this.visibleTodos == 'active'){
          return this.todos.filter(it => !it.completed)
        }
        return this.todos
      },
      //事件发生时数据存到todos中，同时清空输入框内容
      addTodo(e){
        var text = e.target.value.trim()
        if(text){
          this.todos.push({
            content:text,
            completed:false
          })
          e.target.value = ''
        }
      },
      //改变todos中待办的completed状态
      changeTodoState(idx){
        this.todos[idx].completed = !this.todos[idx].completed
      },
      //删除todos中指定idx下标的代办
      deleteTodo(idx){
        this.todos.splice(idx,1)
      },
      //删除todos中已完成的待办
      clearCompleted(){
        this.todos = this.todos.filter(it => !it.completed)
      },
      //钩选所有
      toggleAll(){
        if(this.todos.every(it => it.completed)){
          this.todos.forEach(it => {it.completed = false})
        }else{
          this.todos.forEach(it => it.completed = true)
        }
      }
    }
  })
</script>


<script>
  //初始化页面
  // var notes = JSON.parse(localStorage.getItem("notes")) || {}
  // var memolist = document.querySelector('.memolist')
  // var memo = document.querySelector('.memo')
  // var count = document.querySelector('count')

  // if(notes){
  //   for(var note in notes){
  //     var val = notes[note].content
  //     var active = notes[note].active
  //     addToMemo(val,note,active)
  //   }
  // }

  // //新增条目操作，localStorage存储数据操作
  // memo.addEventListener('keyup',(e) => {
  //   if(e.key === "Enter"){
  //     var notes = JSON.parse(localStorage.getItem("notes")) || {}
  //     var id = Date.now()
  //     notes[id] = {'content':memo.value,'active':true}
  //     saveToStorage(notes)
  //     addToMemo(memo.value,id)
  //     memo.value = ''
  //   }
  // })

  // //自动添加list的函数
  // function addToMemo(content,id,active=true){
  //   let list = document.createElement('li')
  //   let input = document.createElement('input')
  //   let label = document.createElement('label')
  //   let button = document.createElement('button').textContent = '删除'
  //   label.textContent = content
  //   input.type = "checkbox"
  //   input.classList.add(id)
  //   checkEvent(input)
  //   if(!active){
  //     input.checked = true
  //     label.className = 'delete'
  //   }else{
  //     input.checked = false
  //   }
  //   list.append(input,label,button)
  //   memolist.appendChild(list)
    
  // }

  // //自动存储notes到localStorage的函数
  // function saveToStorage(notes) {
  //   localStorage.setItem("notes", JSON.stringify(notes));
  // }

  // //复选框事件侦听
  // function checkEvent(input){
  //   input.addEventListener('change', function(event){
  //     var notes = JSON.parse(localStorage.getItem("notes"))
  //     var boxId = event.target.className
  //     if (event.target.checked) {
  //       event.target.nextElementSibling.className = 'delete'
  //       notes[boxId].active = false
  //       saveToStorage(notes)
  //     } else {
  //       event.target.nextElementSibling.classList.remove('delete')
  //       notes[boxId].active = true
  //       saveToStorage(notes) 
  //     }
  //   })
  // }

</script>

<!-- 
  1、修改localstorage的存储方式，方便存储
  localstorage{
    Notes:{
      id1:{content:xxx,active:true},
      id2:{content:xxx,active:true},
      id3:{content:xxx,active:true}
    }
  }
  //进一步修改，数组存储，方便迭代读取
  localstorage{
    Notes:[
      id1:{content:xxx,active:true},
      id2:{content:xxx,active:true},
      id3:{content:xxx,active:true}
    ]
  }

  2、对应localstorage的存储方式全面修改代码，实现初步效果（20：27 -- ）
    (1)新增条目操作 ✓
    (2)复选框勾选划掉效果，同时active改为false ✓
    (3)最底层统计效果 ✓
    (4)条目最右边的叉删除效果 ✓
    (5)Clear completed删除与现实消失效果
    (6)双击修改数据效果
    (7)esc回退效果
    (8)样式更改

  3、
-->
</html>
